{"componentChunkName":"component---src-templates-blog-post-js","path":"/notificações-no-laravel-5-6-parte-1/","result":{"data":{"markdownRemark":{"fields":{"slug":"/notificações-no-laravel-5-6-parte-1/"},"frontmatter":{"title":"Notificações no Laravel 5.6 (Parte 1)","description":"Primeira parte de uma serie de dois posts sobre como implementar a feature de notificações do Laravel 5.6","date":"21 de setembro de 2020","image":"assets/img/1_zxcy8-4blrjsxuht_034iw.png"},"html":"<p><em>O framework</em> PHP Laravel 5.6 é muito robusto e poderoso. Consequentemente dispõe de diversas <em>features</em> que podem ser adotadas durante o desenvolvimento de aplicações. Uma dessas <em>features</em> é a <a href=\"https://laravel.com/docs/5.6/notifications#introduction\">Notificação</a>.</p>\n<blockquote>\n<p>As notificações possuem o propósito de, oportunamente, enviar mensagens para uma pessoa ou um grupo de pessoas. Sua utilização básica se resume a alertar que um evento ocorreu no sistema.</p>\n</blockquote>\n<p>No Laravel, as notificações transitam através de <a href=\"https://laravel.com/docs/5.6/notifications#specifying-delivery-channels\">Canais</a> de entrega. Por padrão, o <em>framework</em> disponibiliza os seguintes canais: <em>mail, database, broadcast, nexmo e slack</em>. Entretanto a gama de canais pode ser expandida através dos <em>drivers customs</em> disponíveis <a href=\"http://laravel-notification-channels.com/\">neste link</a>.</p>\n<p>Neste tutorial, utilizaremos como canal de entrega o <em><a href=\"https://laravel.com/docs/5.6/notifications#broadcast-notifications\">broadcast</a>,</em> exibiremos notificações simples quando um evento de exemplo for disparado. O tutorial segue o roteiro descrito:</p>\n<ol>\n<li>Setup do projeto e configuração inicial;</li>\n<li>Configuração da classe de notificação;</li>\n<li>Modificação do <em>layout</em> da <em>view</em>;</li>\n<li>Criação da rota que dispara o evento de notificação.</li>\n</ol>\n<p>Ao final, teremos um ícone de notificação na <em>navbar</em> padrão do Laravel, com um contador que incrementa quando uma nova notificação é recebida, e retorna a zero quando as notificações são visualizadas.</p>\n<p>Feita a introdução… Mãos à obra!</p>\n<p><img src=\"https://miro.medium.com/max/980/1*xRdQT8_tGQmyFaoOOOkrbw.gif\" alt=\"Gif do ator Jim Carrey digitando rapidamente em um teclado de computador\"></p>\n<h2>Pré-requisitos:</h2>\n<ul>\n<li>Um ambiente preparado para executar um projeto Laravel 5.6 (sugestão: <a href=\"https://github.com/lissonpsantos2/dockerfiles/tree/master/ubuntu-PHPS\">docker image Ubuntu-PHPS</a>);</li>\n<li>Uma conta no <a href=\"https://pusher.com/\">Pusher</a> com um canal configurado. Ao criar um canal, serão exibidas algumas credenciais que utilizaremos posteriormente.</li>\n</ul>\n<blockquote>\n<p>O Pusher é uma plataforma que adiciona uma camada de conexão ao seu sistema, permitindo a transição de dados em tempo real através de <em>websockets</em> e HTTP.</p>\n</blockquote>\n<ul>\n<li>Um servidor <a href=\"https://www.mongodb.com/\">MongoDB</a> ou de outra base de dados de sua preferência.</li>\n</ul>\n<h2>Procedimento:</h2>\n<p>Inicialmente, criaremos um projeto Laravel. Existem <a href=\"https://laravel.com/docs/5.6/installation\">diversos métodos</a> para realizar essa tarefa, eu adotarei o <a href=\"https://getcomposer.org/\">Composer</a>. No terminal digite:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">composer</span> create-project — prefer-dist laravel/laravel notifications</code></pre></div>\n<p>Após o término do download, entre no diretório do projeto e instale as seguintes dependências:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">cd</span> notifications\n$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span>\n$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save laravel-echo pusher-js cross-env\n$ <span class=\"token function\">composer</span> require pusher/pusher-php-server</code></pre></div>\n<blockquote>\n<p>O pacote laravel-echo é uma biblioteca JavaScript que facilita a inscrição em canais e a escuta de eventos transmitidos pelo Laravel.</p>\n<p>O pusher-js é um cliente JavaScript que se comunicará com o canal criado no Pusher, enquanto o pusher/pusher-php-server é seu correspondente no PHP.</p>\n</blockquote>\n<p>Caso você tenha escolhido o MongoDB, em seguida configure o <a href=\"https://github.com/jenssegers/laravel-mongodb\">jenssegers/laravel-mongodb</a>.</p>\n<blockquote>\n<p>Esta biblioteca, de acordo com o autor e em tradução livre, é Um modelo Eloquent e um construtor Query com suporte para o MongoDB, usando a API original do Laravel. Esta biblioteca estende as classes originais do Laravel, então usa exatamente os mesmos métodos.</p>\n</blockquote>\n<p>O próximo passo é configurar o arquivo <code class=\"language-text\">.env</code> do seu projeto. Nele serão inseridas as credenciais necessárias ao projeto. Caso ainda não o tenha feito, crie uma cópia do arquivo <code class=\"language-text\">.env.example</code> na raiz do projeto e renomei-o para <code class=\"language-text\">.env</code> .</p>\n<p>Agora atualizaremos o <code class=\"language-text\">.env</code> com as credenciais da nossa base de dados e do nosso canal no Pusher.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">DB_CONNECTION=mongodb\nDB_HOST=\nDB_PORT=\nDB_DATABASE=\nDB_USERNAME=\nDB_PASSWORD=\n\nBROADCAST_DRIVER=pusher\n\nPUSHER_APP_ID=\nPUSHER_APP_KEY=\nPUSHER_APP_SECRET=\nPUSHER_APP_CLUSTER=\n\nMIX_PUSHER_APP_KEY=&quot;${PUSHER_APP_KEY}&quot;\nMIX_PUSHER_APP_CLUSTER=&quot;${PUSHER_APP_CLUSTER}&quot;</code></pre></div>\n<p>Prosseguiremos abrindo o arquivo <code class=\"language-text\">/app/user.php</code> e substituindo a linha que contém <code class=\"language-text\">use Authenticatable</code> por <code class=\"language-text\">use Jenssegers\\Mongodb\\Auth\\User as Authenticatable;</code> .</p>\n<blockquote>\n<p>Esta etapa permitirá, através dessa interface, executar a <em><a href=\"https://laravel.com/docs/5.6/migrations\">migration</a></em> que cria a <em><a href=\"https://docs.mongodb.com/manual/core/databases-and-collections/\">collection</a></em> de usuários, bem como efetuar o <em>login</em> no MongoDB.</p>\n</blockquote>\n<p>No arquivo <code class=\"language-text\">/config/broadcasting.php</code> , em <code class=\"language-text\">connections</code>, adicione</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token single-quoted-string string\">'pusher'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n         <span class=\"token single-quoted-string string\">'driver'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'pusher'</span><span class=\"token punctuation\">,</span>\n         <span class=\"token single-quoted-string string\">'key'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'PUSHER_APP_KEY'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n         <span class=\"token single-quoted-string string\">'secret'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'PUSHER_APP_SECRET'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n         <span class=\"token single-quoted-string string\">'app_id'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'PUSHER_APP_ID'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n         <span class=\"token single-quoted-string string\">'options'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n             <span class=\"token single-quoted-string string\">'cluster'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'PUSHER_APP_CLUSTER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             <span class=\"token single-quoted-string string\">'encrypted'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token boolean constant\">true</span><span class=\"token punctuation\">,</span>\n         <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n     <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<blockquote>\n<p>Nesta etapa, estamos configurando o canal de <em>broadcast</em> que utilizaremos ao disparar a notificação. Observe que estamos utilizando as credencias atribuídas anteriormente no nosso arquivo <code class=\"language-text\">.env</code> .</p>\n</blockquote>\n<p>O passo seguinte é descomentar a linha <code class=\"language-text\">App\\Providers\\BroadcastServiceProvider::class</code> no arquivo <code class=\"language-text\">/config/app.php</code> .</p>\n<blockquote>\n<p>Deste modo, estamos registrando o <em>provider</em> de <em>broadcast</em> que nos permitirá registrar as rotas de autorização de <em>broadcast</em> e as funções de <em>callback</em>.</p>\n</blockquote>\n<p>Agora iremos configurar o nosso cliente Pusher no JavaScript. Esse cliente será responsável por se inscrever no canal criado e consequentemente receber as informações que forem postadas no mesmo.</p>\n<p>Para realizar esse procedimento, abra o arquivo <code class=\"language-text\">/resources/assets/js/bootstrap.js</code> e descomente da linha 47 até a linha 56. Este trecho corresponde ao seguinte bloco de código:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> Echo <span class=\"token keyword\">from</span> <span class=\"token string\">\"laravel-echo\"</span>\n\nwindow<span class=\"token punctuation\">.</span>Pusher <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pusher-js\"</span><span class=\"token punctuation\">)</span>\n\nwindow<span class=\"token punctuation\">.</span>Echo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Echo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  broadcaster<span class=\"token operator\">:</span> <span class=\"token string\">\"pusher\"</span><span class=\"token punctuation\">,</span>\n  key<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">MIX_PUSHER_APP_KEY</span><span class=\"token punctuation\">,</span>\n  cluster<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">MIX_PUSHER_APP_CLUSTER</span><span class=\"token punctuation\">,</span>\n  encrypted<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Para finalizar a etapa inicial de configuração e, por consequência, a primeira parte desse tutorial, iremos executar os comandos que criarão a base de dados de usuário e a classe da nossa notificação, respectivamente:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">npm</span> run dev\n$ php artisan make:auth\n$ php artisan migrate\n$ php artisan make:notification StatusLiked</code></pre></div>\n<blockquote>\n<p>Note que estamos criando uma classe de notificação chamada <strong>StatusLiked</strong>. Posteriormente, iremos personalizá-la.</p>\n</blockquote>\n<p>Feito isto, <strong>se tudo ocorreu bem até aqui</strong>, estamos prontos para prosseguir para a <a href=\"https://medium.com/sysvale/notifica%C3%A7%C3%B5es-no-laravel-5-6-parte-2-6007f4dbd696\">segunda parte do tutorial</a>, onde configuraremos a nossa notificação e o editaremos nosso layout.</p>\n<p>Até breve.</p>\n<p><img src=\"https://miro.medium.com/max/960/1*nMz-i2ypSzsAN5fZSoR31Q.gif\" alt=\"Gif do personagem Bob Esponja saindo por uma porta com um olhar faceiro, com a frase &#x22;See You Soon!&#x22;\"></p>","timeToRead":5}},"pageContext":{"slug":"/notificações-no-laravel-5-6-parte-1/","previousPost":null,"nextPost":null}},"staticQueryHashes":["3344698684","422059704","764694655"]}